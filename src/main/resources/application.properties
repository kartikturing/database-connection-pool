# =============================================================================
# HikariCP Database Connection Pool Configuration
# High-Performance Settings for Production Use
# =============================================================================

# Core Pool Configuration
# Maximum number of connections in the pool (default: 10)
# Formula: pool_size = Tn Ã— (Cm - 1) + 1 where Tn = threads, Cm = connections per thread
app.datasource.hikari.maximum-pool-size=20

# Minimum number of idle connections maintained in the pool
# Setting this lower than maximum-pool-size allows the pool to shrink during low activity
app.datasource.hikari.minimum-idle=5

# Timeout Configuration (all values in milliseconds)
# Maximum time to wait for a connection from the pool (20 seconds)
# Should be lower than any upstream timeout to fail fast
app.datasource.hikari.connection-timeout=20000

# Maximum lifetime of a connection in the pool (20 minutes)
# Should be shorter than database's connection timeout to prevent stale connections
app.datasource.hikari.max-lifetime=1200000

# Maximum time a connection can sit idle in the pool (5 minutes)
# Connections idle longer than this will be retired
app.datasource.hikari.idle-timeout=300000

# Maximum time to validate connection aliveness (5 seconds)
app.datasource.hikari.validation-timeout=5000

# Performance and Reliability Settings
# Time threshold for connection leak detection (1 minute)
# Helps identify connections that are not being properly closed
app.datasource.hikari.leak-detection-threshold=60000

# Auto-commit behavior for connections
app.datasource.hikari.auto-commit=true

# Query used to validate connections before use
app.datasource.hikari.connection-test-query=SELECT 1

# Monitoring and JMX Configuration
# Enable JMX MBeans for monitoring pool metrics
app.datasource.hikari.register-mbeans=true

# Name of the connection pool for identification in monitoring tools
app.datasource.hikari.pool-name=HikariCP-Primary

# =============================================================================
# Database Configuration
# =============================================================================

# H2 In-Memory Database (for demonstration)
# Replace with your actual database configuration
app.datasource.hikari.jdbc-url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
app.datasource.hikari.username=sa
app.datasource.hikari.password=
app.datasource.hikari.driver-class-name=org.h2.Driver

# =============================================================================
# Alternative Database Configurations (uncomment as needed)
# =============================================================================

# MySQL Configuration
# app.datasource.hikari.jdbc-url=jdbc:mysql://localhost:3306/mydb?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
# app.datasource.hikari.username=root
# app.datasource.hikari.password=password
# app.datasource.hikari.driver-class-name=com.mysql.cj.jdbc.Driver
# app.datasource.hikari.connection-test-query=SELECT 1

# PostgreSQL Configuration
# app.datasource.hikari.jdbc-url=jdbc:postgresql://localhost:5432/mydb
# app.datasource.hikari.username=postgres
# app.datasource.hikari.password=password
# app.datasource.hikari.driver-class-name=org.postgresql.Driver
# app.datasource.hikari.connection-test-query=SELECT 1

# Oracle Configuration
# app.datasource.hikari.jdbc-url=jdbc:oracle:thin:@localhost:1521:XE
# app.datasource.hikari.username=system
# app.datasource.hikari.password=password
# app.datasource.hikari.driver-class-name=oracle.jdbc.OracleDriver
# app.datasource.hikari.connection-test-query=SELECT 1 FROM DUAL

# SQL Server Configuration
# app.datasource.hikari.jdbc-url=jdbc:sqlserver://localhost:1433;databaseName=mydb
# app.datasource.hikari.username=sa
# app.datasource.hikari.password=password
# app.datasource.hikari.driver-class-name=com.microsoft.sqlserver.jdbc.SQLServerDriver
# app.datasource.hikari.connection-test-query=SELECT 1

# =============================================================================
# Spring Boot Actuator Configuration
# =============================================================================

# Expose health and custom connection pool endpoints
management.endpoints.web.exposure.include=health,info,connectionpool,metrics

# Show detailed health information
management.endpoint.health.show-details=always

# Enable health indicators
management.health.db.enabled=true

# Custom actuator endpoint base path
management.endpoints.web.base-path=/actuator

# =============================================================================
# Logging Configuration
# =============================================================================

# Enable detailed HikariCP logging for monitoring and debugging
logging.level.com.zaxxer.hikari=INFO
logging.level.com.zaxxer.hikari.HikariConfig=DEBUG
logging.level.com.zaxxer.hikari.pool.HikariPool=INFO

# Application logging
logging.level.com.example.connectionpool=INFO

# SQL logging (uncomment for debugging)
# logging.level.org.springframework.jdbc.core.JdbcTemplate=DEBUG
# logging.level.org.springframework.jdbc.core.StatementCreatorUtils=TRACE

# =============================================================================
# Spring Boot Application Configuration
# =============================================================================

# Application name
spring.application.name=database-connection-pool-demo

# Server port
server.port=8080

# =============================================================================
# Performance Tuning Properties
# =============================================================================

# JVM settings for optimal performance (add to JVM arguments)
# -XX:+UseG1GC
# -XX:MaxGCPauseMillis=200
# -Xms512m
# -Xmx2g
# -XX:+HeapDumpOnOutOfMemoryError

# =============================================================================
# Environment-Specific Overrides
# =============================================================================

# Development Environment
# app.datasource.hikari.leak-detection-threshold=30000
# logging.level.com.zaxxer.hikari=DEBUG

# Production Environment
# app.datasource.hikari.maximum-pool-size=50
# app.datasource.hikari.minimum-idle=10
# app.datasource.hikari.leak-detection-threshold=0
# logging.level.com.zaxxer.hikari=WARN

# Load Testing Environment
# app.datasource.hikari.maximum-pool-size=100
# app.datasource.hikari.minimum-idle=20
# app.datasource.hikari.connection-timeout=10000
